
var gameEngine={ele:null,allBullet:{},allEnemy:{},totalScore:0,init:function(){gameEngine.ele=document.getElementById("main");return this;},start:function(){console.log("开始游戏");gameEngine.loadding(function(){console.log("游戏加载完毕");myPlane.init().move();myPlane.fire();gameEngine.listeningKeybord();gameEngine.createEnemy();gameEngine.listeningCrash();gameEngine.moveBackground();});},loadding:function(callback){let logo=document.createElement("div");logo.className="logo";gameEngine.ele.appendChild(logo);let load=document.createElement("div");load.className="load";gameEngine.ele.appendChild(load);let imgs=["images2/loading1.png","images2/loading2.png","images2/loading3.png"];let i=0;let timer=setInterval(function(){if(i>=5){clearInterval(timer);gameEngine.ele.removeChild(logo);gameEngine.ele.removeChild(load);callback();}
else{load.style.background="url("+imgs[++i%3]+") no-repeat";}},500);},listeningKeybord:function(){var xSpeed=0;var ySpeed=0;window.onkeydown=function(e){e=e||event;if(e.keyCode==37){xSpeed=-10;}
else if(e.keyCode==39){xSpeed=10;}
else if(e.keyCode==38){ySpeed=-10;}
else if(e.keyCode==40){ySpeed=10;}}
window.onkeyup=function(){xSpeed=0;ySpeed=0;}
setInterval(function(){var x=myPlane.ele.offsetLeft+xSpeed;if(x<0){x=0;}
if(x>gameEngine.ele.offsetWidth-myPlane.ele.offsetWidth){x=gameEngine.ele.offsetWidth-myPlane.ele.offsetWidth}
myPlane.ele.style.left=x+"px";myPlane.ele.style.top=myPlane.ele.offsetTop+ySpeed+"px";},30);},createEnemy:function(){setInterval(function(){var flag=Math.random()>0.4?true:false;if(flag){var enemy=new Enemy(Enemy.prototype.Enemy_Type_Small);enemy.init().move();}},1000);setInterval(function(){var flag=Math.random()>0.6?true:false;if(flag){var enemy=new Enemy(Enemy.prototype.Enemy_Type_Middle);enemy.init().move();}},2000);setInterval(function(){var flag=Math.random()>0.5?true:false;if(flag){var enemy=new Enemy(Enemy.prototype.Enemy_Type_Large);enemy.init().move();}},8000);},listeningCrash:function(){var isCrashMyPlane=false;setInterval(function(){for(var i in gameEngine.allEnemy){for(var j in gameEngine.allBullet){if(isCrash(gameEngine.allEnemy[i].ele,gameEngine.allBullet[j].ele)){gameEngine.allBullet[j].boom();delete gameEngine.allBullet[j];gameEngine.allEnemy[i].hurt();}}
if(!isCrashMyPlane&&isCrash(gameEngine.allEnemy[i].ele,myPlane.ele)){isCrashMyPlane=true;console.log("Game Over");var myName=prompt("您的总分数是:"+gameEngine.totalScore+", 请输入您的大名");if(myName){ajax({type:"post",url:"http://60.205.181.47/myPHPCode4/uploadScore.php",data:{name:myName,score:gameEngine.totalScore},async:true,success:function(data){console.log(data);location.href="03_rand.html";},error:function(){console.log("error");}})}
else{location.reload();}}}},30);},moveBackground:function(){var y=0;setInterval(function(){gameEngine.ele.style.backgroundPositionY=y++ +"px";},30);},score:function(){}}